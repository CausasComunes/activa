### Database
The two main entities that the system uses are *candidates* and *projects*. Some fields of the candidates are: name, surname, photo and social media accounts. Some fields of the projects are: name, description, image and videos.

There are also *charges*. These charges are loaded into the system manually. Some charges we use for our scenario are: deputy, senator and chief of government. Each candidate has a charge, and each project has a group of charges assigned to it. This way, not all candidates are involved in every project, just the ones which charge is assigned to that project.

Candidates also have a *stance* for every project, setted in the administrative panel. They can be: in favor, against, abstaining or not confirmed. From the stance that the candidate has, the platform will suggest a *message* to send to that candidate. These messages are defined for every project, for every possible stance, and there can be multiple messages per stance.

### General service structure
This platform has a frontend and a backend. The frontend is build with *Angular 5.2.10*, and tested using *Yarn 1.19.1* and *Node 10.16.3*. The backend is made using *CakePHP 3.8.\**, with *PHP 7.3.3* + *Apache* and *MySql*. The frontend gets all its content and images from the backend’s API. The backend, apart from having this API, has an administrative web console to change/upload data manually.

### Running the project locally
#### Backend
To test the backend just run `docker-compose up` from backend's root directory. This will create a MySql container and another container for the mail application, as you can see in [`docker-compose.yaml`](backend/docker-compose.yaml). Once started you can navigate to [http://localhost:7000/](http://localhost:7000/)  and login to the administration panel using `admin`/`admin`.

#### Frontend
To test the frontend Node and Yarn has to be installed. As mentioned previously, the versions that worked for us were 10.16.3 and 1.19.1 respectively. Once having these two applications, you should first install all dependencies doing `yarn install` inside frontend’s root folder. If everything goes well, you can run `yarn start`, hosting the application in [http://localhost:4200/](http://localhost:4200/).

### Some key files
#### Frontend
- `src/index.html` is the site’s base html, where Angular attaches to the `<app-root>` element
- `src/app/app.component.*` is the Angular base file, where all routes mount on `<router-outlet>` element
- `src/app/helpers/routes.helper.ts` system routes (that is to say, all URLs accepted)
- `src/app/pages/*` website’s pages, where all the previous routes point to. Inside here there is:
  - `main` home page 
  - `project-view` project detail page, you get here by clicking on the home page’s project list
  - `full-list` page with the full candidate list, you get here by clicking on "Ver listado completo" within a project
- `src/services/*` GET/POST functions that communicate with the backend’s API, they are called from Angular components
- `src/model/*` API models; these files have classes used for converting json responses of API’s GET/POST requests into javascript objects.
- `src/theme/*` general scss styles and variables
- `src/assets/images/*` system’s images
- `dist/*` files generated by `yarn build`; these compiled files are the ones uploaded to the production server

### Some useful configurations
#### Connection from frontend to backend
To do this you should edit  `api` and `imgBase` parameters in [`frontend/package.json`](frontend/package.json). The frontend loads these variables in `src/environments/environment.ts`.

In production environment (Docker) these URLs are hardcoded in `src/environments/environment.prod.ts`. 

#### Adding routes (backend)
If you wish to add routes to the API or to the administrative panel you have to edit the file `config/routes.php` by adding the route, and edit the file `src/Controller/AppController.php` to allow access to the function (action) that the previous route utilizes.

#### LAN hosting the frontend for local sharing
To be able to do this, run  `yarn startlan` instead of `yarn start` . Before doing this you should change the IP it uses, inside `packaje.json`, in the `scripts` section, on the command `startlan` (line ~11)

### Known bugs
#### JPG images
The backend doesn’t allow JPG/JPEG images. They must be converted to PNG, GIF or other formats to be able to upload them.

#### Frontend on iPhones
On some iPhones 6 the frontend freezes or only half of the page is loaded.
